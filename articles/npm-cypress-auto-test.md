---
title: "Cypressによる自動e2eテスト導入How to"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React", "Cypress", "TypeScript", "Test", "frontend"]
published: false
---

# 10 秒で概要

- どのテストツールでもそうですが、テストの種類を意識して、どこのグループに合致するテストを行っているのかを意識しないことにはテストの意味が有りません。
- Cypress を代表とする E2E テストでは、統合テスト・システムテストフェーズの、機能テストで利用できます。また、変更関連のテストとして、リグレッションテストや無影響テストにも利用できます。

# テストの種類

テストの種類は、開発工程と品質特性に基づく分類に応じて、「テストレベル」と「テストタイプ」が存在します。これは、フロントエンド開発に限った話ではありません。

[JSTQB-SyllabusFoundation](http://jstqb.jp/dl/JSTQB-SyllabusFoundation_Version2018V31.J03.pdf)によると、以下のように分類されます。

## テストレベル

2.2 テストレベルにて、テストレベルの定義は以下のように記載されています。

> テストレベルは、系統的にまとめ、マネジメントしていくテストの活動のグループである。
> （中略）
> テストレベルはソフトウェア開発ライフサイクル内の他の活動と関連付けられる。

テストの活動のグループとしては、以下の種類にグルーピングされます。

- コンポーネントテスト
- 統合テスト
  - コンポーネント間やシステム間の相互処理に焦点をあてる
  - 典型的なテスト対象の例としては、サブシステム、データベース、インフラ、インターフェース、マイクロサービス間が挙げられる
- システムテスト
  - ユースケースから見て、システムが機能的に正しい振る舞いであることを確認する
  - 非機能的振る舞いのテスト
- 受入テスト

## テストタイプ

2.3 テストタイプはにて、テストタイプの定義は以下のように記載されています。

> テストタイプは、以下に列挙する特定のテストの目的から見たソフトウェアシステム（あるいはシステムの一部分）の特性をテストするための活動を束ねたものである。
> • 機能の品質特性、例えば完全、正確および適切であることなどを評価する。
> • 非機能の品質特性、例えば信頼性、性能効率性、セキュリティ、互換性、使用性などを評価する。
> • コンポーネントまたはシステムの、構造またはアーキテクチャーが正しく完全で仕様通りであることを評価する。
> • 欠陥が修正されていることを確認するなどの変更による影響を評価し（確認テスト）、ソフトウェアや環境の変更に

つまり、以下の種類に分類することができます。

- 機能テスト
- 非機能テスト
- ホワイトボックステスト
  - 機能テストをブラックボックステストとするならば、カバレッジベースでアーキテクチャが仕様通りであることを評価するためのテストを指す。
- 変更関連のテスト
  - 無影響テスト
  - リグレッションテスト

また、全てのテストタイプは、すべてのテストレベルでも実行が可能です。

## E2E テスト

E2E テストとは、User Interface Test とも呼ばれ、システム全体を通して行うテストです。どんなテストもそうですが、上記の「テストレベル」及び「テストタイプ」のどの種類に該当するかを意識しなければ、網羅的なテストを行うことはできません。フロントエンドを SPA フレームワーク、サーバサイドを何らかの REST API で構成されたシステムを例として、E2E テストは以下の場面で利用ができると考えます。

- テストレベル
  - 統合テスト
    - フロントエンドとバックエンドの結合テストとして、REST API で定義されたインターフェースレベルの合致をテストする
  - システムテスト
    - 実際のユースケースにおける操作を定義し、タスク実行時の機能的なふるまいをテストする
- テストタイプ
  - 機能テスト
    - システムテストにおける機能的な振る舞いのテストを行う
  - 変更関連のテスト
    - CI ツールに組み込むことで、リグレッションテストや無影響テストの自動化を行う

E2E テストにおけるツールは、以下の種類が有ります。

- [Cypress](https://github.com/cypress-io/cypress)
  - 要素特定のセレクタが jQuery と似通っており、jQuery ユーザからしたら理解しやすい
- [Playwright](https://github.com/microsoft/playwright)
  - Microsoft が主として開発を行う OSS
  - Puppeteer 開発者が作っており、Puppeteer の後継と言っても過言では無い
  - セレクタの書き方が Cypress とは異なり多少癖がある
  - Cypress より速い
- [Puppeteer](https://github.com/puppeteer/puppeteer)
  - Google が主として開発を行う OSS
  - 単体ではテストツールとして機能せず、Jest のようなテストフレームワークと組み合わせが必要
- Selenium
  - テストツールというよりは、ブラウザの自動操作ツール

現時点で Cypress と Playwright の採用が多い印象です。ツール間の比較としては、[Playwright vs Cypress](https://medium.com/sparebank1-digital/playwright-vs-cypress-1e127d9157bd)が参考になりました。

# 環境構築

## 前提

```bash
$ node -v
v16.13.1
$ npm -v
8.2.0
$ yarn -v
1.22.17
```

[npm](https://www.npmjs.com/)にて、cypress の最新バージョンを確認します。執筆時点では`9.2.0`なので、yarn add にてプロジェクトに導入します。

`$ yarn add -D cypress`
